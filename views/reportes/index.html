<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes y Estadísticas - Sistema de Pinturas</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

    <!-- jsPDF y jsPDF AutoTable para exportar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <!-- SheetJS para exportar Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Estilos personalizados -->
    <link href="../../assets/css/style.css" rel="stylesheet">
</head>

<body>
    <div class="main-wrapper">
        <!-- Sidebar -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Navbar -->
            <div id="navbar-container"></div>

            <!-- Content -->
            <div class="content-wrapper">
                <!-- Page Header -->
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="bi bi-graph-up-arrow me-2"></i>Reportes y Estadísticas
                    </h1>
                    <div class="page-breadcrumb">
                        <i class="bi bi-house-door"></i>
                        <span>Inicio</span>
                        <i class="bi bi-chevron-right"></i>
                        <span>Reportes</span>
                    </div>
                </div>

                <!-- Resumen Cards -->
                <div class="row g-3 mb-4">
                    <div class="col-md-3">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <p class="text-muted mb-1">Ventas Hoy</p>
                                        <h3 class="mb-0">Q<span id="ventasHoy">0.00</span></h3>
                                    </div>
                                    <div class="bg-primary bg-opacity-10 p-3 rounded">
                                        <i class="bi bi-cash-stack text-primary fs-2"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <p class="text-muted mb-1">Ventas Semana</p>
                                        <h3 class="mb-0">Q<span id="ventasSemana">0.00</span></h3>
                                    </div>
                                    <div class="bg-success bg-opacity-10 p-3 rounded">
                                        <i class="bi bi-calendar-week text-success fs-2"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <p class="text-muted mb-1">Ventas Mes</p>
                                        <h3 class="mb-0">Q<span id="ventasMes">0.00</span></h3>
                                    </div>
                                    <div class="bg-info bg-opacity-10 p-3 rounded">
                                        <i class="bi bi-calendar3 text-info fs-2"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <p class="text-muted mb-1">Facturas Hoy</p>
                                        <h3 class="mb-0"><span id="facturasHoy">0</span></h3>
                                    </div>
                                    <div class="bg-warning bg-opacity-10 p-3 rounded">
                                        <i class="bi bi-receipt text-warning fs-2"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filtros de Fecha -->
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row g-3 align-items-end">
                            <div class="col-md-2">
                                <label class="form-label fw-bold">Mes</label>
                                <select class="form-select" id="selectMes">
                                    <option value="1">Enero</option>
                                    <option value="2">Febrero</option>
                                    <option value="3">Marzo</option>
                                    <option value="4">Abril</option>
                                    <option value="5">Mayo</option>
                                    <option value="6">Junio</option>
                                    <option value="7">Julio</option>
                                    <option value="8">Agosto</option>
                                    <option value="9">Septiembre</option>
                                    <option value="10">Octubre</option>
                                    <option value="11">Noviembre</option>
                                    <option value="12">Diciembre</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label fw-bold">Año</label>
                                <select class="form-select" id="selectAnio">
                                    <!-- Se llenará dinámicamente -->
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label fw-bold">Ver Ventas del Día</label>
                                <input type="date" class="form-control" id="inputFechaDia">
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-primary w-100" onclick="ReportesController.cargarVentasDia()">
                                    <i class="bi bi-search"></i> Buscar Día
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gráfica Comparativa: Compras vs Ventas -->
                <div class="card mb-4">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">
                            <i class="bi bi-graph-up me-2"></i>
                            Comparativa: Compras vs Ventas (Mensual)
                        </h5>
                    </div>
                    <div class="card-body">
                        <canvas id="chartComprasVsVentas" height="80"></canvas>
                    </div>
                </div>

                <!-- Gráficas de Pastel -->
                <div class="row g-3 mb-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-white">
                                <h5 class="mb-0">
                                    <i class="bi bi-pie-chart me-2"></i>
                                    Ventas por Categoría
                                </h5>
                            </div>
                            <div class="card-body">
                                <canvas id="chartVentasCategorias" height="200"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-white">
                                <h5 class="mb-0">
                                    <i class="bi bi-credit-card me-2"></i>
                                    Métodos de Pago
                                </h5>
                            </div>
                            <div class="card-body">
                                <canvas id="chartMetodosPago" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Top Productos -->
                <div class="card mb-4">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">
                            <i class="bi bi-trophy me-2"></i>
                            Top 10 Productos Más Vendidos
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Producto</th>
                                        <th>Presentación</th>
                                        <th class="text-end">Cantidad</th>
                                        <th class="text-end">Total Vendido</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaTopProductos">
                                    <tr>
                                        <td colspan="5" class="text-center">
                                            <div class="spinner-border" role="status">
                                                <span class="visually-hidden">Cargando...</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Ventas del Día (Se muestra al buscar) -->
                <div class="card mb-4" id="cardVentasDia" style="display: none;">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-calendar-day me-2"></i>
                            Ventas del Día: <span id="fechaSeleccionada"></span>
                        </h5>
                        <button class="btn btn-sm btn-outline-secondary" onclick="document.getElementById('cardVentasDia').style.display='none'">
                            <i class="bi bi-x-lg"></i>
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info mb-3">
                            <div class="row">
                                <div class="col-md-6">
                                    <strong>Total de Facturas:</strong> <span id="totalFacturasDia">0</span>
                                </div>
                                <div class="col-md-6">
                                    <strong>Total en Ventas:</strong> Q<span id="totalVentasDia">0.00</span>
                                </div>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead>
                                    <tr>
                                        <th>Factura</th>
                                        <th>Cliente</th>
                                        <th>Usuario</th>
                                        <th class="text-end">Total</th>
                                        <th>Hora</th>
                                        <th class="text-center">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaVentasDia">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <hr class="my-5">

                <!-- SECCIÓN DE REPORTES DETALLADOS -->
                <div class="card">
                    <div class="card-header bg-white">
                        <h4 class="mb-0"><i class="bi bi-file-earmark-bar-graph me-2"></i>Reportes Detallados</h4>
                    </div>
                    <div class="card-body">
                        <!-- Tabs de Navegación -->
                        <ul class="nav nav-tabs mb-4" id="reportesTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="tab-r1" data-bs-toggle="tab" data-bs-target="#reporte1" type="button">
                                    <i class="bi bi-cash-stack"></i> R1: Ventas por Método
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="tab-r2" data-bs-toggle="tab" data-bs-target="#reporte2" type="button">
                                    <i class="bi bi-trophy"></i> R2: Top Ingresos
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="tab-r3" data-bs-toggle="tab" data-bs-target="#reporte3" type="button">
                                    <i class="bi bi-cart4"></i> R3: Top Cantidades
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="tab-r4" data-bs-toggle="tab" data-bs-target="#reporte4" type="button">
                                    <i class="bi bi-boxes"></i> R4: Inventario General
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="tab-r5" data-bs-toggle="tab" data-bs-target="#reporte5" type="button">
                                    <i class="bi bi-arrow-down-circle"></i> R5: Menos Ventas
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="tab-r6" data-bs-toggle="tab" data-bs-target="#reporte6" type="button">
                                    <i class="bi bi-exclamation-triangle"></i> R6: Sin Stock
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="tab-r7" data-bs-toggle="tab" data-bs-target="#reporte7" type="button">
                                    <i class="bi bi-search"></i> R7: Buscar Factura
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="tab-r8" data-bs-toggle="tab" data-bs-target="#reporte8" type="button">
                                    <i class="bi bi-box-arrow-in-down"></i> R8: Ingresos Inventario
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="tab-r9" data-bs-toggle="tab" data-bs-target="#reporte9" type="button">
                                    <i class="bi bi-dash-circle"></i> R9: Stock Mínimo
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="tab-r10" data-bs-toggle="tab" data-bs-target="#reporte10" type="button">
                                    <i class="bi bi-shop"></i> R10: Por Tienda
                                </button>
                            </li>
                        </ul>

                        <!-- Contenido de los Tabs -->
                        <div class="tab-content" id="reportesTabContent">

                            <!-- REPORTE 1: Total Facturado por Método de Pago -->
                            <div class="tab-pane fade show active" id="reporte1" role="tabpanel">
                                <h5 class="mb-3">Informe de Ventas por Método de Pago</h5>
                                <p class="text-muted">Muestra el total facturado entre dos fechas, desglosado por método de pago.</p>

                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <label class="form-label fw-bold">Fecha Inicio</label>
                                        <input type="date" class="form-control" id="r1FechaInicio">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label fw-bold">Fecha Fin</label>
                                        <input type="date" class="form-control" id="r1FechaFin">
                                    </div>
                                    <div class="col-md-3 d-flex align-items-end">
                                        <button class="btn btn-primary me-2" onclick="ReportesController.generarReporte1()">
                                            <i class="bi bi-search"></i> Generar
                                        </button>
                                        <button class="btn btn-success me-2" onclick="ReportesController.exportarReporte1('excel')">
                                            <i class="bi bi-file-earmark-excel"></i> Excel
                                        </button>
                                        <button class="btn btn-danger" onclick="ReportesController.exportarReporte1('pdf')">
                                            <i class="bi bi-file-earmark-pdf"></i> PDF
                                        </button>
                                    </div>
                                </div>

                                <div id="r1Resultados">
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle me-2"></i>Seleccione un rango de fechas y presione "Generar"
                                    </div>
                                </div>
                            </div>

                            <!-- REPORTE 2: Productos que Más Dinero Generan -->
                            <div class="tab-pane fade" id="reporte2" role="tabpanel">
                                <h5 class="mb-3">Productos que Más Dinero Generan</h5>
                                <p class="text-muted">Muestra los productos ordenados por el total de ingresos generados entre dos fechas.</p>

                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <label class="form-label fw-bold">Fecha Inicio</label>
                                        <input type="date" class="form-control" id="r2FechaInicio">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label fw-bold">Fecha Fin</label>
                                        <input type="date" class="form-control" id="r2FechaFin">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label fw-bold">Límite</label>
                                        <input type="number" class="form-control" id="r2Limite" value="20" min="1">
                                    </div>
                                    <div class="col-md-4 d-flex align-items-end">
                                        <button class="btn btn-primary me-2" onclick="ReportesController.generarReporte2()">
                                            <i class="bi bi-search"></i> Generar
                                        </button>
                                        <button class="btn btn-success me-2" onclick="ReportesController.exportarReporte2('excel')">
                                            <i class="bi bi-file-earmark-excel"></i> Excel
                                        </button>
                                        <button class="btn btn-danger" onclick="ReportesController.exportarReporte2('pdf')">
                                            <i class="bi bi-file-earmark-pdf"></i> PDF
                                        </button>
                                    </div>
                                </div>

                                <div id="r2Resultados">
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle me-2"></i>Seleccione un rango de fechas y presione "Generar"
                                    </div>
                                </div>
                            </div>

                            <!-- REPORTE 3: Productos Más Vendidos (Cantidades) -->
                            <div class="tab-pane fade" id="reporte3" role="tabpanel">
                                <h5 class="mb-3">Productos Más Vendidos por Cantidad</h5>
                                <p class="text-muted">Muestra los productos ordenados por la cantidad total vendida entre dos fechas.</p>

                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <label class="form-label fw-bold">Fecha Inicio</label>
                                        <input type="date" class="form-control" id="r3FechaInicio">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label fw-bold">Fecha Fin</label>
                                        <input type="date" class="form-control" id="r3FechaFin">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label fw-bold">Límite</label>
                                        <input type="number" class="form-control" id="r3Limite" value="20" min="1">
                                    </div>
                                    <div class="col-md-4 d-flex align-items-end">
                                        <button class="btn btn-primary me-2" onclick="ReportesController.generarReporte3()">
                                            <i class="bi bi-search"></i> Generar
                                        </button>
                                        <button class="btn btn-success me-2" onclick="ReportesController.exportarReporte3('excel')">
                                            <i class="bi bi-file-earmark-excel"></i> Excel
                                        </button>
                                        <button class="btn btn-danger" onclick="ReportesController.exportarReporte3('pdf')">
                                            <i class="bi bi-file-earmark-pdf"></i> PDF
                                        </button>
                                    </div>
                                </div>

                                <div id="r3Resultados">
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle me-2"></i>Seleccione un rango de fechas y presione "Generar"
                                    </div>
                                </div>
                            </div>

                            <!-- REPORTE 4: Inventario Actual General -->
                            <div class="tab-pane fade" id="reporte4" role="tabpanel">
                                <h5 class="mb-3">Inventario Actual General</h5>
                                <p class="text-muted">Muestra el inventario completo actual de todos los productos.</p>

                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <label class="form-label fw-bold">Categoría</label>
                                        <select class="form-select" id="r4Categoria">
                                            <option value="">Todas las categorías</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3 d-flex align-items-end">
                                        <button class="btn btn-primary me-2" onclick="ReportesController.generarReporte4()">
                                            <i class="bi bi-search"></i> Generar
                                        </button>
                                        <button class="btn btn-success me-2" onclick="ReportesController.exportarReporte4('excel')">
                                            <i class="bi bi-file-earmark-excel"></i> Excel
                                        </button>
                                        <button class="btn btn-danger" onclick="ReportesController.exportarReporte4('pdf')">
                                            <i class="bi bi-file-earmark-pdf"></i> PDF
                                        </button>
                                    </div>
                                </div>

                                <div id="r4Resultados">
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle me-2"></i>Presione "Generar" para ver el inventario actual
                                    </div>
                                </div>
                            </div>

                            <!-- REPORTE 5: Productos con Menos Ventas -->
                            <div class="tab-pane fade" id="reporte5" role="tabpanel">
                                <h5 class="mb-3">Productos con Menos Ventas</h5>
                                <p class="text-muted">Muestra los productos con menor cantidad de ventas registradas.</p>

                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <label class="form-label fw-bold">Fecha Inicio</label>
                                        <input type="date" class="form-control" id="r5FechaInicio">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label fw-bold">Fecha Fin</label>
                                        <input type="date" class="form-control" id="r5FechaFin">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label fw-bold">Límite</label>
                                        <input type="number" class="form-control" id="r5Limite" value="20" min="1">
                                    </div>
                                    <div class="col-md-4 d-flex align-items-end">
                                        <button class="btn btn-primary me-2" onclick="ReportesController.generarReporte5()">
                                            <i class="bi bi-search"></i> Generar
                                        </button>
                                        <button class="btn btn-success me-2" onclick="ReportesController.exportarReporte5('excel')">
                                            <i class="bi bi-file-earmark-excel"></i> Excel
                                        </button>
                                        <button class="btn btn-danger" onclick="ReportesController.exportarReporte5('pdf')">
                                            <i class="bi bi-file-earmark-pdf"></i> PDF
                                        </button>
                                    </div>
                                </div>

                                <div id="r5Resultados">
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle me-2"></i>Seleccione un rango de fechas y presione "Generar"
                                    </div>
                                </div>
                            </div>

                            <!-- REPORTE 6: Productos Sin Stock -->
                            <div class="tab-pane fade" id="reporte6" role="tabpanel">
                                <h5 class="mb-3">Productos Sin Stock</h5>
                                <p class="text-muted">Muestra los productos que no cuentan con existencias y necesitan ser adquiridos.</p>

                                <div class="row mb-3">
                                    <div class="col-md-3 d-flex align-items-end">
                                        <button class="btn btn-primary me-2" onclick="ReportesController.generarReporte6()">
                                            <i class="bi bi-search"></i> Generar
                                        </button>
                                        <button class="btn btn-success me-2" onclick="ReportesController.exportarReporte6('excel')">
                                            <i class="bi bi-file-earmark-excel"></i> Excel
                                        </button>
                                        <button class="btn btn-danger" onclick="ReportesController.exportarReporte6('pdf')">
                                            <i class="bi bi-file-earmark-pdf"></i> PDF
                                        </button>
                                    </div>
                                </div>

                                <div id="r6Resultados">
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle me-2"></i>Presione "Generar" para ver los productos sin stock
                                    </div>
                                </div>
                            </div>

                            <!-- REPORTE 7: Buscar Factura por Número -->
                            <div class="tab-pane fade" id="reporte7" role="tabpanel">
                                <h5 class="mb-3">Búsqueda de Factura</h5>
                                <p class="text-muted">Buscar una factura por su número y ver su detalle completo.</p>

                                <div class="row mb-3">
                                    <div class="col-md-2">
                                        <label class="form-label fw-bold">Serie</label>
                                        <input type="text" class="form-control" id="r7Serie" placeholder="A" maxlength="10">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label fw-bold">Número de Factura</label>
                                        <input type="number" class="form-control" id="r7Numero" placeholder="123456">
                                    </div>
                                    <div class="col-md-3 d-flex align-items-end">
                                        <button class="btn btn-primary me-2" onclick="ReportesController.generarReporte7()">
                                            <i class="bi bi-search"></i> Buscar
                                        </button>
                                        <button class="btn btn-success" onclick="ReportesController.exportarReporte7('pdf')">
                                            <i class="bi bi-printer"></i> Imprimir
                                        </button>
                                    </div>
                                </div>

                                <div id="r7Resultados">
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle me-2"></i>Ingrese el número de factura y presione "Buscar"
                                    </div>
                                </div>
                            </div>

                            <!-- REPORTE 8: Ingresos al Inventario -->
                            <div class="tab-pane fade" id="reporte8" role="tabpanel">
                                <h5 class="mb-3">Ingresos al Inventario</h5>
                                <p class="text-muted">Muestra el historial de ingresos de productos al inventario (compras).</p>

                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <label class="form-label fw-bold">Fecha Inicio</label>
                                        <input type="date" class="form-control" id="r8FechaInicio">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label fw-bold">Fecha Fin</label>
                                        <input type="date" class="form-control" id="r8FechaFin">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label fw-bold">Proveedor</label>
                                        <select class="form-select" id="r8Proveedor">
                                            <option value="">Todos los proveedores</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3 d-flex align-items-end">
                                        <button class="btn btn-primary me-2" onclick="ReportesController.generarReporte8()">
                                            <i class="bi bi-search"></i> Generar
                                        </button>
                                        <button class="btn btn-success me-2" onclick="ReportesController.exportarReporte8('excel')">
                                            <i class="bi bi-file-earmark-excel"></i> Excel
                                        </button>
                                        <button class="btn btn-danger" onclick="ReportesController.exportarReporte8('pdf')">
                                            <i class="bi bi-file-earmark-pdf"></i> PDF
                                        </button>
                                    </div>
                                </div>

                                <div id="r8Resultados">
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle me-2"></i>Seleccione un rango de fechas y presione "Generar"
                                    </div>
                                </div>
                            </div>

                            <!-- REPORTE 9: Productos con Stock Mínimo -->
                            <div class="tab-pane fade" id="reporte9" role="tabpanel">
                                <h5 class="mb-3">Productos con Stock Mínimo</h5>
                                <p class="text-muted">Muestra los productos que tienen stock menor o igual al mínimo permitido.</p>

                                <div class="row mb-3">
                                    <div class="col-md-3 d-flex align-items-end">
                                        <button class="btn btn-primary me-2" onclick="ReportesController.generarReporte9()">
                                            <i class="bi bi-search"></i> Generar
                                        </button>
                                        <button class="btn btn-success me-2" onclick="ReportesController.exportarReporte9('excel')">
                                            <i class="bi bi-file-earmark-excel"></i> Excel
                                        </button>
                                        <button class="btn btn-danger" onclick="ReportesController.exportarReporte9('pdf')">
                                            <i class="bi bi-file-earmark-pdf"></i> PDF
                                        </button>
                                    </div>
                                </div>

                                <div id="r9Resultados">
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle me-2"></i>Presione "Generar" para ver los productos con stock mínimo
                                    </div>
                                </div>
                            </div>

                            <!-- REPORTE 10: Inventario por Tienda -->
                            <div class="tab-pane fade" id="reporte10" role="tabpanel">
                                <h5 class="mb-3">Inventario por Tienda</h5>
                                <p class="text-muted">Muestra el inventario actual distribuido por tienda/sucursal.</p>

                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <label class="form-label fw-bold">Tienda</label>
                                        <select class="form-select" id="r10Tienda">
                                            <option value="">Todas las tiendas</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3 d-flex align-items-end">
                                        <button class="btn btn-primary me-2" onclick="ReportesController.generarReporte10()">
                                            <i class="bi bi-search"></i> Generar
                                        </button>
                                        <button class="btn btn-success me-2" onclick="ReportesController.exportarReporte10('excel')">
                                            <i class="bi bi-file-earmark-excel"></i> Excel
                                        </button>
                                        <button class="btn btn-danger" onclick="ReportesController.exportarReporte10('pdf')">
                                            <i class="bi bi-file-earmark-pdf"></i> PDF
                                        </button>
                                    </div>
                                </div>

                                <div id="r10Resultados">
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle me-2"></i>Presione "Generar" para ver el inventario por tienda
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Modal Detalles de Venta -->
    <div class="modal fade" id="modalDetalleVenta" tabindex="-1" aria-labelledby="modalDetalleVentaLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalDetalleVentaLabel">
                        <i class="bi bi-receipt me-2"></i>Detalles de Venta
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Loading -->
                    <div id="detalleVentaLoading" class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                        <p class="mt-2">Cargando detalles...</p>
                    </div>

                    <!-- Contenido del detalle -->
                    <div id="detalleVentaContenido" style="display: none;">
                        <!-- Información de la Factura -->
                        <div class="card mb-3">
                            <div class="card-header bg-primary text-white">
                                <strong>Factura: <span id="detalleNumeroFactura"></span></strong>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Cliente:</strong> <span id="detalleCliente"></span></p>
                                        <p><strong>NIT:</strong> <span id="detalleNit"></span></p>
                                        <p><strong>Dirección:</strong> <span id="detalleDireccion"></span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Usuario:</strong> <span id="detalleUsuario"></span></p>
                                        <p><strong>Fecha:</strong> <span id="detalleFecha"></span></p>
                                        <p><strong>Hora:</strong> <span id="detalleHora"></span></p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Productos -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <strong>Productos</strong>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-sm mb-0">
                                        <thead>
                                            <tr>
                                                <th>Producto</th>
                                                <th>Presentación</th>
                                                <th class="text-end">Cantidad</th>
                                                <th class="text-end">Precio</th>
                                                <th class="text-end">Subtotal</th>
                                            </tr>
                                        </thead>
                                        <tbody id="detalleProductos">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Pagos -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <strong>Pagos</strong>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-sm mb-0">
                                        <thead>
                                            <tr>
                                                <th>Método de Pago</th>
                                                <th>Referencia</th>
                                                <th class="text-end">Monto</th>
                                            </tr>
                                        </thead>
                                        <tbody id="detallePagos">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Totales -->
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 offset-md-6">
                                        <table class="table table-sm">
                                            <tr>
                                                <th>Subtotal:</th>
                                                <td class="text-end">Q<span id="detalleSubtotal">0.00</span></td>
                                            </tr>
                                            <tr>
                                                <th>Descuento:</th>
                                                <td class="text-end">Q<span id="detalleDescuento">0.00</span></td>
                                            </tr>
                                            <tr>
                                                <th>IVA:</th>
                                                <td class="text-end">Q<span id="detalleIva">0.00</span></td>
                                            </tr>
                                            <tr class="table-primary">
                                                <th>TOTAL:</th>
                                                <th class="text-end">Q<span id="detalleTotal">0.00</span></th>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i>Cerrar
                    </button>
                    <button type="button" class="btn btn-primary" id="btnReimprimirFactura">
                        <i class="bi bi-printer me-1"></i>Reimprimir Factura
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- Config -->
    <script src="../../config/api.js"></script>

    <!-- Utilities -->
    <script src="../../utils/storage.js"></script>
    <script src="../../utils/permissions.js"></script>
    <script src="../../utils/alerts.js"></script>
    <script src="../../utils/loader.js"></script>
    <script src="../../utils/formatter.js"></script>

    <!-- Services -->
    <script src="../../services/auth.service.js"></script>
    <script src="../../services/reportes.service.js"></script>

    <!-- App principal (contiene loadLayout y logout) -->
    <script src="../../assets/js/app.js"></script>

    <!-- Controlador -->
    <script src="../../controllers/reportes.controller.js"></script>

    <!-- Inicializar -->
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Cargar layout (navbar + sidebar)
            await loadLayout();

            // Inicializar controller
            await ReportesController.init();
        });
    </script>
</body>
</html>
